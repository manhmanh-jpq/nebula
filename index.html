<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>Nebula Studio Pro - Acer Nitro 16</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #webcam-container { position: absolute; top: 15px; right: 15px; width: 220px; height: 165px; border: 2px solid #0ff; border-radius: 10px; overflow: hidden; z-index: 100; background: #111; }
        #webcam { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .controls { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 100; }
        .btn { padding: 12px 25px; border-radius: 30px; border: none; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .btn-photo { background: #555; color: white; }
        .btn-video { background: #ff4757; color: white; }
        .btn:hover { transform: scale(1.1); filter: brightness(1.2); }
        #status { position: absolute; top: 20px; left: 20px; color: #0ff; font-size: 14px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="status">H·ªÜ TH·ªêNG: ƒêANG KH·ªûI T·∫†O AI...</div>
    <div id="webcam-container"><video id="webcam" autoplay playsinline></video></div>
    
    <div class="controls">
        <button class="btn btn-photo" onclick="takePhoto()">üì∑ CH·ª§P ·∫¢NH</button>
        <button class="btn btn-video" id="recBtn" onclick="toggleRecord()">üî¥ QUAY VIDEO</button>
    </div>

    <script>
        let scene, camera, renderer, particles, basePos, hands, mediaRecorder, recordedChunks = [];
        let expansion = 0, targetExpansion = 0;

        // 1. KH·ªûI T·∫†O ƒê·ªí H·ªåA QU·∫¢ C·∫¶U
        function initThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.z = 4;

            renderer = new THREE.WebGLRenderer({ antialias: true, preserveDrawingBuffer: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const geo = new THREE.BufferGeometry();
            const count = 15000;
            const pos = new Float32Array(count * 3);
            basePos = new Float32Array(count * 3);

            for(let i=0; i<count; i++) {
                // C√¥ng th·ª©c t·∫°o h√¨nh c·∫ßu chu·∫©n
                const phi = Math.acos(-1 + (2 * i) / count);
                const theta = Math.sqrt(count * Math.PI) * phi;
                basePos[i*3] = Math.cos(theta) * Math.sin(phi) * 1.5;
                basePos[i*3+1] = Math.sin(theta) * Math.sin(phi) * 1.5;
                basePos[i*3+2] = Math.cos(phi) * 1.5;
            }
            geo.setAttribute('position', new THREE.BufferAttribute(new Float32Array(basePos), 3));
            particles = new THREE.Points(geo, new THREE.PointsMaterial({ color: 0x00ffff, size: 0.015, transparent: true, blending: THREE.AdditiveBlending }));
            scene.add(particles);
        }

        // 2. KH·ªûI T·∫†O AI HANDS
        const videoElement = document.getElementById('webcam');
        hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({ maxNumHands: 2, modelComplexity: 1, minDetectionConfidence: 0.6 });
        
        hands.onResults((results) => {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length === 2) {
                const h1 = results.multiHandLandmarks[0][9];
                const h2 = results.multiHandLandmarks[1][9];
                const d = Math.sqrt(Math.pow(h1.x-h2.x, 2) + Math.pow(h1.y-h2.y, 2));
                targetExpansion = d * 6; // ƒê·ªô nh·∫°y t·ªëi ∆∞u cho Nitro 16
                document.getElementById('status').innerText = "H·ªÜ TH·ªêNG: ƒê√É K·∫æT N·ªêI TAY";
            } else {
                targetExpansion = 0;
                document.getElementById('status').innerText = "H·ªÜ TH·ªêNG: ƒêANG T√åM 2 TAY...";
            }
        });

        const cam = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 640, height: 480
        });
        cam.start();

        // 3. V√íNG L·∫∂P ANIMATION
        function animate() {
            expansion += (targetExpansion - expansion) * 0.1;
            const positions = particles.geometry.attributes.position.array;
            
            for(let i=0; i<15000; i++) {
                const factor = 1 + expansion;
                positions[i*3] = basePos[i*3] * factor;
                positions[i*3+1] = basePos[i*3+1] * factor;
                positions[i*3+2] = basePos[i*3+2] * factor;
            }
            particles.geometry.attributes.position.needsUpdate = true;
            particles.rotation.y += 0.002;
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        // 4. CH·ª®C NƒÇNG PH·ª§ (CH·ª§P/QUAY)
        function takePhoto() {
            const link = document.createElement('a');
            link.download = 'nebula-nebula.png';
            link.href = renderer.domElement.toDataURL();
            link.click();
        }

        function toggleRecord() {
            const btn = document.getElementById('recBtn');
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                btn.innerText = "üî¥ QUAY VIDEO";
                btn.style.background = "#ff4757";
            } else {
                recordedChunks = [];
                const stream = renderer.domElement.captureStream(30);
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = 'nebula-video.webm'; a.click();
                };
                mediaRecorder.start();
                btn.innerText = "‚èπ D·ª™NG QUAY";
                btn.style.background = "#2ed573";
            }
        }

        window.onload = () => { initThree(); animate(); };
    </script>
</body>
</html>
