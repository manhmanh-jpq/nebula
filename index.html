<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xmas Spherical Pro - Interactive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #050505; font-family: 'Segoe UI', sans-serif; }
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        #video-container { position: absolute; width: 100%; height: 100%; z-index: 0; opacity: 0.3; transform: scaleX(-1); display: none; }
        
        #help-panel { position: absolute; top: 20px; left: 20px; z-index: 20; background: rgba(0,0,0,0.85); border-left: 4px solid #ff0000; padding: 20px; border-radius: 8px; color: white; width: 300px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .help-title { color: #ff0000; font-weight: bold; margin-bottom: 12px; font-size: 16px; text-transform: uppercase; }
        .help-item { margin-bottom: 10px; font-size: 13px; display: flex; align-items: center; gap: 10px; }

        #ui-layer { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 10; display: flex; gap: 20px; }
        .btn { background: linear-gradient(135deg, #ff4757, #ff6b81); border: none; color: white; padding: 15px 25px; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4); transition: 0.3s; }
        .btn:hover { transform: scale(1.05); filter: brightness(1.1); }

        #color-picker { position: absolute; top: 20px; right: 20px; z-index: 10; background: rgba(255,255,255,0.05); backdrop-filter: blur(15px); padding: 15px; border-radius: 20px; color: white; border: 1px solid rgba(255,255,255,0.1); }
        .cp-row { margin: 10px 0; display: flex; justify-content: space-between; align-items: center; gap: 20px; font-size: 12px; }
        input[type="color"] { border: none; width: 28px; height: 28px; cursor: pointer; background: none; border-radius: 50%; }

        /* Messages */
        #msg-xmas { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 45px; font-weight: 800; opacity: 0; transition: 1s; z-index: 5; text-align: center; text-shadow: 0 0 20px rgba(255,255,255,0.5); }
        #msg-no-gift { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ff4d4d; font-size: 55px; font-weight: 900; opacity: 0; transition: 0.5s; z-index: 6; text-shadow: 0 0 30px rgba(255,0,0,0.8); }
        
        #modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; display: none; align-items: center; justify-content: center; }
        #rec-indicator { position: absolute; top: 25px; left: 350px; color: #ff0000; font-weight: bold; display: none; z-index: 10; align-items: center; gap: 8px; }
    </style>
</head>
<body>

    <div id="help-panel">
        <div class="help-title">Điều khiển cử chỉ</div>
        <div class="help-item"><i class="fas fa-hand-pointer"></i> 1 bàn tay để xoay cây thông 360°</div>
        <div class="help-item"><i class="fas fa-arrows-alt-h"></i> 2 bàn tay kéo rộng để xem bất ngờ</div>
        <div class="help-title" style="margin-top:15px; color:#ffd700;">Tùy chỉnh màu</div>
        <div class="help-item"><i class="fas fa-star"></i> Đổi màu ngôi sao & 5 tầng lá</div>
    </div>

    <div id="video-container"><video id="webcam" autoplay playsinline></video></div>
    <div id="canvas-container"></div>
    <div id="msg-xmas">làm trái tim đi sẽ có bất ngờ</div>
    <div id="msg-no-gift">tao chưa có quà ^ ^</div>
    <div id="rec-indicator"><span style="width:10px; height:10px; background:red; border-radius:50%; display:inline-block;"></span> REC</div>

    <div id="ui-layer">
        <button class="btn" onclick="takePhoto()"><i class="fas fa-camera"></i> ẤN VÀO ĐÊ ĐỂ SELFI NHÓ BABE</button>
        <button class="btn" onclick="showRecModal()"><i class="fas fa-microphone"></i> Ở ĐÂY LÀ QUAY KÈM MIC LUÔN ĐÓ</button>
    </div>

    <div id="color-picker">
        <div class="cp-row">Ngôi sao <input type="color" id="cStar" value="#ffff00" onchange="updateColors()"></div>
        <div class="cp-row">Tầng lá 1 <input type="color" id="c1" value="#004d00" onchange="updateColors()"></div>
        <div class="cp-row">Tầng lá 2 <input type="color" id="c2" value="#006400" onchange="updateColors()"></div>
        <div class="cp-row">Tầng lá 3 <input type="color" id="c3" value="#008000" onchange="updateColors()"></div>
        <div class="cp-row">Tầng lá 4 <input type="color" id="c4" value="#228b22" onchange="updateColors()"></div>
        <div class="cp-row">Tầng lá 5 <input type="color" id="c5" value="#32cd32" onchange="updateColors()"></div>
        <div class="cp-row">Gốc cây <input type="color" id="cTrunk" value="#5d2906" onchange="updateColors()"></div>
    </div>

    <div id="modal">
        <div style="
